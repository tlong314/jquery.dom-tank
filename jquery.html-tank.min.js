;!function(e){e.fn.htmlTank=function(t){function s(){var t=e.Deferred();return z.mouse&&!z.controls&&e(z.appendControlsTo).append(T),e("body").append(k),setTimeout(function(){t.resolve()},500),t.promise()}function n(){z.mouse&&(T.on("mousedown",J),T.on("mouseup",K),T.on("contextmenu",b)),z.keys&&(e(window).on("keydown",U),e(window).on("keyup",V))}function o(e){var t="",s="",n=e?P:I;switch(Math.abs(n)%6){case 0:case 1:s="|&nbsp;&nbsp;";break;case 2:case 3:s="&nbsp;|&nbsp;";break;case 4:case 5:s="&nbsp;&nbsp;|"}for(var o=0;g>o;o+=6)t+=s;e?C.html(t):S.html(t)}function i(){A&&(e("#htmlTankBullet").remove(),j=0),A=!0,weaponR=g/2+Math.min(80,g/2),H=r().x,X=r().y,D=H+(weaponR+10)*Math.cos(Math.PI*Y/180)-5,N=X+(weaponR+10)*Math.sin(Math.PI*Y/180)-5,O=Y;var t=e("<div></div>").attr("id","htmlTankBullet").css({width:"10px",height:"10px",background:"orange",position:"fixed",left:D+"px",top:N+"px","border-radius":"2px",margin:"0",padding:"0",border:"0","box-shadow":"1px 1px 2px #222"});e("body").append(t)}function a(){var t=e("#htmlTankBullet");if(0!==t.length){var s=D+(j+10)*Math.cos(Math.PI*O/180),n=N+(j+10)*Math.sin(Math.PI*O/180);t.css({left:s+"px",top:n+"px"})}}function r(){return{x:parseFloat(k.css("left").substring(-2),10)+g/2,y:parseFloat(k.css("top").substring(-2),10)+(x+44)/2}}function l(){var e=parseFloat(k.css("left").substring(0,k.css("left").length-2),10)+g/2,t=parseFloat(k.css("top").substring(0,k.css("top").length-2),10)+(x+44)/2;newX=e+z.tankSpeed*Math.cos(Math.PI*Y/180)-g/2,newY=t+z.tankSpeed*Math.sin(Math.PI*Y/180)-(x+44)/2,k.css({left:newX+"px",top:newY+"px"}),I+=z.tankSpeed,o(0),P+=z.tankSpeed,o(1)}function c(){var e=parseFloat(k.css("left").substring(0,k.css("left").length-2),10)+g/2,t=parseFloat(k.css("top").substring(0,k.css("top").length-2),10)+(x+44)/2;newX=e-z.tankSpeed*Math.cos(Math.PI*Y/180)-g/2,newY=t-z.tankSpeed*Math.sin(Math.PI*Y/180)-(x+44)/2,k.css({left:newX+"px",top:newY+"px"}),I-=z.tankSpeed,o(0),P-=z.tankSpeed,o(1)}function p(){I+=z.tankSpeed,o(0),Y+=z.angleSpeed,Y>=360&&(Y-=360),k.css("transform","rotate("+Y+"deg)")}function d(){P+=z.tankSpeed,o(1),Y-=z.angleSpeed,0>Y&&(Y+=360),k.css("transform","rotate("+Y+"deg)")}function h(){R&&B?l():R?p():B?d():F&&c(),A&&(j+=z.bulletSpeed),j>z.bulletRange?(j=0,A=!1,e("#htmlTankBullet").remove()):a()}function u(){z.mouse&&(T.off("mousedown",J),T.off("mouseup",K),T.off("contextmenu",b)),z.keys&&(e(window).off("keydown",U),e(window).off("keyup",V)),k.remove(),T.remove(),e("#htmlTankBullet").remove(),f.css("visibility","visible"),f.find("*").css("visibility","visible"),clearInterval(W)}function b(e){return!1}if(0!==e("#htmlTankCustomTank").length)return this;var f=this,k=null,m=null,g=this.outerWidth(),x=this.outerHeight(),w="",v="",y=this.offset().top-22-e("html").scrollTop(),M=this.offset().left-e("html").scrollLeft(),S=null,C=null,T=null,I=0,P=0,R=!1,B=!1,F=!1,W=1,H=0,X=0,Y=0,D=H,N=X,O=Y,j=0,A=!1,L="|&nbsp;&nbsp;",Q="",q={tankSpeed:1,angleSpeed:1,bulletSpeed:5,bulletRange:500,wheelsCss:{},weaponCss:{},controlsCss:{},tankCss:{},controlsHtml:"Click/right click in this box<br/><br/>to drive the tank.",keys:!0,mouse:!0,timerSpeed:20,controls:null,appendControlsTo:e("body")},z=e.extend(q,t);-1===this.css("width").indexOf("px")&&(w=this.innerWidth()+"px"),-1===this.css("height").indexOf("px")&&(v=this.innerWidth()+"px"),k=e("<div></div>").attr("id","htmlTankCustomTank"),m=this.clone().css({margin:"0",width:w,"max-height":v}).css(z.tankCss),S=e("<div></div>").attr("id","leftWheel").css({"background-color":"green",color:"black",height:"20px",width:g,overflow:"hidden","line-height":"20px",font:"16px Times New Roman","border-top":"1px solid black","border-bottom":"1px solid black","borde-left":"none","border-right":"none",margin:"0",padding:"0"}).css(z.wheelsCss),C=e("<div></div>").attr("id","rightWheel").css({"background-color":"green",color:"black",height:"20px",width:g,overflow:"hidden","line-height":"20px",font:"16px Times New Roman","border-top":"1px solid black","border-bottom":"1px solid black","borde-left":"none","border-right":"none",margin:"0",padding:"0"}).css(z.wheelsCss),S.insertBefore(m),C.insertAfter(m);for(var E=0;g>E;E+=6)Q+=L;S.html(Q),C.html(Q);var G=e("<div></div>").css({width:Math.min(80,g/2)+"px",height:"20px",border:"1px solid black","border-left":"none",background:"green",position:"absolute",top:(x+44)/2-11+"px",left:g+"px",margin:"0",padding:"0"}).css(z.weaponCss);m.append(G),k.css({width:g+"px",height:x+44+"px",position:"fixed",top:y+"px",left:M+"px",padding:"0",border:"0",margin:"0"}).append(S).append(m).append(C),this.css("visibility","hidden"),this.find("*").css("visibility","hidden"),z.mouse&&(T=z.controls?e(z.controls).css(z.controlsCss).html(z.controlsHtml):e("<div></div>").attr("id","tankControls").css({position:"fixed",bottom:"20px",right:"20px",width:"300px",height:"200px","background-color":"black",color:"white",cursor:"none",margin:"0",padding:"10px","text-align":"right"}).css(z.controlsCss).html(z.controlsHtml)),s().done(function(){n()}),W=setInterval(h,z.timerSpeed);var J=function(e){switch(e.preventDefault(),this.contextmenu=null,e.which){case 1:R=!0,B=!1;break;case 2:R=!0,B=!0;break;case 3:B=!0,R=!1}},K=function(e){switch(e.preventDefault(),this.contextmenu=null,e.which){case 1:R=!1;break;case 2:R=!1,B=!1;break;case 3:B=!1}},U=function(e){switch(e.which){case 37:case 65:"reverse"===z.keys?(R=!0,B=!1):(B=!0,R=!1);break;case 38:case 87:R=!0,B=!0;break;case 39:case 68:"reverse"===z.keys?(B=!0,R=!1):(R=!0,B=!1);break;case 40:case 83:R=!1,B=!1,F=!0;break;case 13:i();break;case 27:u()}},V=function(e){switch(e.which){case 37:case 65:"reverse"===z.keys?R=!1:B=!1;break;case 38:case 87:R=!1,B=!1;break;case 39:case 68:"reverse"===z.keys?B=!1:R=!1;break;case 40:case 83:F=!1}};return this}}(jQuery);